name: After PR merging

on:
  pull_request:
    types:
      - closed

jobs:
  if_merged:
    if: github.event.pull_request.merged == true
    runs-on: ubuntu-latest
    steps:

      - uses: actions/checkout@v3
        env:
          WEBSITE_REPO: ${{ secrets.WEBSITE_REPO }}
        if: ${{ env.WEBSITE_REPO != '' }}
        with:
          repository: ${{ secrets.WEBSITE_REPO }}
          ref: 'master'
          token:  ${{ secrets.API_TOKEN_GITHUB }}

      - name: Setup git config
        env:
          WEBSITE_REPO: ${{ secrets.WEBSITE_REPO }}
        if: ${{ env.WEBSITE_REPO != '' }}
        run: |
          git config user.name "userz"
          git config user.email "<>"

      - name: Delete old build artifacts
        env:
          WEBSITE_REPO: ${{ secrets.WEBSITE_REPO }}
        if: ${{ env.WEBSITE_REPO != '' }}
        run: |
          git rm -r static/build/artifact/PR${{ github.event.number }}/
          git commit -m "ðŸ¤– PR â„–${{ github.event.number }} merged, deleting old build artifacts"

      - run: git push origin master
        env:
          WEBSITE_REPO: ${{ secrets.WEBSITE_REPO }}
        if: ${{ env.WEBSITE_REPO != '' }}
